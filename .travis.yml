language: python

matrix:
    include:
        - os: linux
          python: "nightly"
        - os: linux
          python: "3.4"
        - os: linux
          python: "3.5"
        - os: osx
          python: "3.4"
        - os: osx
          python: "3.5"

install:
  - if [[ ! "$TRAVIS_PYTHON_VERSION" == "nightly" ]]; then
      wget https://repo.continuum.io/miniconda/Miniconda3-latest-Linux-x86_64.sh -O miniconda.sh;
      bash miniconda.sh -b -p $HOME/miniconda;
      export PATH="$HOME/miniconda/bin:$PATH";
      hash -r;
      conda config --set always_yes yes --set changeps1 no;
      conda update -q conda;
      conda info -a;
    fi

  - if [[ "$TRAVIS_PYTHON_VERSION" == "3.4" ]]; then
      conda install -y python=3.4 pygments prompt_toolkit ply pytest pytest-cov pytest-timeout;
      pip install pytest-flake8 codecov;
      python setup.py install;
    elif [[ "$TRAVIS_PYTHON_VERSION" == "3.5" ]]; then
      conda install -y python=3.5 pygments prompt_toolkit ply pytest pytest-cov pytest-timeout;
      pip install pytest-flake8 codecov;
      python setup.py install;
    else
      pip install --upgrade -r requirements-tests.txt;
    fi

script:
  - py.test --flake8 --cov=. --cov-report=term --timeout=10

after_success:
  - codecov
